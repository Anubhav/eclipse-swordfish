<?xml version="1.0" encoding="UTF-8"?>
<!--============================================================================
    Copyright (c) 2007 Deutsche Post AG.
    All rights reserved. This program and the accompanying materials
    are made available under the terms of the Eclipse Public License v1.0
    which accompanies this distribution, and is available at
    http://www.eclipse.org/legal/epl-v10.html
    
    Contributors:
       Deutsche Post AG - initial API and implementation
 ============================================================================-->
<component:configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://schemas.sopware.org/provider/TSP/1.0 tsp_conf_combined-remote.xsd"
    xmlns:sop_gen="http://schemas.sopware.org/configuration/generic/1.0"
    xmlns:common="http://schemas.sopware.org/configuration/common/1.0"
    xmlns:component="http://schemas.sopware.org/provider/TSP/1.0">
    <component:keystore name="default" sop_gen:version="1.0"
        xmlns="http://schemas.sopware.org/security/XKMS/1.0">
        <type>jks</type>
        <password>test</password>
        <name>kstore.jks</name>
    </component:keystore>
    <component:service-registry name="default" sop_gen:version="1.0"
        xmlns="http://schemas.sopware.org/serviceregistry/SR/1.0">
        <!-- Default timeout for HTTP requests. -->
        <init-param name="default.timeout" value="5000"/>
        <!-- Minimum number of idle service registies in the pool. -->
        <init-param name="sr.pool.minIdle" value="2"/>
        <!-- Maximum number of idle service registies in the pool. -->
        <init-param name="sr.pool.maxIdle" value="5"/>
        <!-- The maximum size a stream may have if converted to a string. -->
        <init-param name="max.streamsize" value="1048576"/>
        <!-- max number of ldap connections -->
        <init-param name="storage.ldap.maxConn" value="4"/>
        <!-- The time in ms that agreed policies are valid -->
        <init-param name="agreed.policy.valid.durationtime" value="7200"/>
        <!-- Init property for Responsetime handler. -->
        <init-param name="assertion.handler.responsetime.transport" value="2000"/>
    </component:service-registry>
    <component:certificate name="default" sop_gen:version="1.0"
        xmlns="http://schemas.sopware.org/security/XKMS/1.0">
        <trustanchor-cer> trustanchor.cer</trustanchor-cer>
        <certpath-encoding>pkipath</certpath-encoding>
    </component:certificate>
    <component:certificate name="default" sop_gen:version="1.1"
        xmlns="http://schemas.sopware.org/security/XKMS/1.0">
        <trustanchor-cer> trustanchor.cer</trustanchor-cer>
        <certpath-encoding>pkipath</certpath-encoding>
    </component:certificate>
    <!--certpath-encoding>PKCS7</certpath-encoding-->


    <component:authorization name="default" sop_gen:version="1.0"
        xmlns="http://schemas.sopware.org/security/PRIV/1.0">

        <pmazn-factory>
            <factoryName> org.sopware.sec.pmazn.impl.ldap.PrivilegeManagementFactoryLdap
            </factoryName>
        </pmazn-factory>

        <ldap>
            <!-- OPTIONAL DEFAULT: com.sun.jndi.ldap.LdapCtxFactory -->
            <common:initial-context-factory>initial-context-factory>com.sun.jndi.ldap.LdapCtxFactory </common:initial-context-factory>

            <!-- OBLIGAT The LDAP provider url incl. root context -->
            <common:providerURL>ldap://sopsparc06-4.servicebackbone.org:389/ou=DataAuthorizationTSP,o=SOPware </common:providerURL>

            <!-- OPTIONAL DEFAULT: simple POSIBBLE: simple, none. All others not supported  -->
            <!-- if 'none', bindDN and bindPassword will be ignored. If 'simple', both properties -->
            <!-- are oblogatory -->
            <common:secure-auth>simple</common:secure-auth>

            <!-- OBLIGAT (if secure-auth = simple) The LDAP user identifier -->
            <common:bindDN>uid=SystemUserAuthorizationTSP,ou=People,o=SOPware</common:bindDN>

            <!-- OBLIGAT (if secure-auth = simple) THe Ldap bind password -->
            <common:bindPassword>secret</common:bindPassword>

            <!-- OPTIONAL Flag which enables/disables the per context connection pooling -->
            <!-- DEFAULT: false -->
            <common:connection-pool>true</common:connection-pool>
        </ldap>

        <!-- describes the access to the pm roles structure section of the ldap schema-->

        <type id="role">
            <baseDN>ou=roles</baseDN>
            <objectclass name="organizationalRole">
                <attribute name="name" ldap="cn" key="true"/>
                <attribute name="description" ldap="description" optional="true"/>
                <attribute name="actors" ldap="roleOccupant" optional="true" indexed="true"
                    type="account"/>
            </objectclass>
        </type>

        <type id="account">
            <baseDN>ou=accounts</baseDN>
            <objectclass name="person">
                <attribute name="name" ldap="cn" key="true"/>
                <attribute ldap="sn" default="${name}"/>
                <attribute name="description" ldap="description" optional="true"/>
            </objectclass>
        </type>

        <type id="resource">
            <baseDN>ou=resources</baseDN>
            <objectclass name="device">
                <attribute name="name" ldap="cn" key="true"/>
                <attribute name="description" ldap="description" optional="true"/>
            </objectclass>
        </type>

        <type id="privilege">
            <baseDN>ou=privileges</baseDN>
            <objectclass name="sopPMPrivilege">
                <!--attribute name="name" ldap="sopPMAction" key="true" /-->
                <attribute name="permission" ldap="sopPMPermission"/>
                <!--1-->
                <attribute name="target" ldap="sopPMResource" type="resource"/>
                <attribute name="action" ldap="sopPMAction"/>
                <attribute name="actors" ldap="sopPMActor" optional="true" indexed="true"
                    type="account"/>
            </objectclass>
        </type>

        <saml>
            <!-- saml issuer identifier -->
            <general-issuer>SOP Privilege-Management Service</general-issuer>

            <!-- location descripton of the keystore which will be used for signing -->
            <keystore>
                <name>keyStore.jks</name>
                <password>atleast8</password>
                <certalias>client</certalias>
            </keystore>

            <assertion>
                <!-- the certificate will not be part of the assertion  -->
                <signSerialNumbersOnly>true</signSerialNumbersOnly>

                <!-- an assertion expires after MINUTES -->
                <expires>120</expires>
            </assertion>
        </saml>

        <sanitycheck>

            <!--OPTIONAL, DEFAULT=0, The time between two sanity checks. Default is -->
            <!--0min, means no sanitiy check will be made. -->
            <common:period>5</common:period>


            <!--OPTIONAL, DEFAULT=30000, The time in ms the Timer waits before he -->
            <!--starts a timer teak -->
            <common:delay>30000</common:delay>


            <!--OPTIONAL, DEFAULT=1000, The minimal time in ms which a connection -->

            <!--to a backend must be available. If its not possible to create a connection -->

            <!--to a backend in the given time, the backend will be declared as dead.-->
            <common:maxObservationProcessingTime>1000</common:maxObservationProcessingTime>

        </sanitycheck>

    </component:authorization>
</component:configuration>
